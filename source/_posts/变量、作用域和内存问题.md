---
title: 变量、作用域和内存问题
tags: ['javascript']
date: 2014-09-20 00:34:14
---

> 基本类型和引用类型
> 执行环境
> 垃圾收集

<!-- more -->
按照ECMA-262的定义，Javascript的变量与其他语言的变量有很大区别，其松散类型的本质决定它只是在特定时间用于保存特定值的一个名字而已。

## 基本类型和引用类型

Javascript变量可以用来保存两种类型的值：基本类型值和引用类型值。

基本类型的值源自以下5种基本数据类型：Undefined、Null、Boolean、Number和String。基本类型值和引用类型值具有以下特点：

1. 基本类型值在内存中占据固定大小的空间，因此被保存在栈内存中；
2. 从一个变量向另一个变量复制基本类型的值，会创建这个值的一个副本；
3. 引用类型的值是对象，保存在堆内存中；
4. 包含引用类型值的变量实际上包含的并不是对象本身，而是一个指向该对象的副本；
5. 从一个变量向另一个变量复制引用类型的值，复制的其实是指针，因此两个变量最终都指向同一个对象；
6. 确定一个值是哪种基本类型可以使用typeof操作符，而确定一个值是哪种引用类型可以使用instanceof操作符。

```js
//基本类型
var a = 5;
var b = a;
console.log(a)//5
console.log(b)//5
//引用类型
var obj1 = new Object();
var obj2 = obj1;
obj2.name = "Feng";
console.log(obj1.name);    // "Feng"
```
所有变量（包括基本类型和引用类型）都存在于一个执行环境（也称为作用域）当中，
这个执行环境决定了变量的生命周期，以及哪一部分代码可以访问其中的变量。
以下关于执行环境的几点总结：
1. 执行环境有全局执行环境（也称全局环境）和函数执行环境之分；
2. 每次进入一个新执行环境，都会创建一个用于搜索变量和函数的作用域链；
3. 函数的局部环境不仅有权访问函数作用域中的变量，而且有权访问其包含（父）环境，
乃至全局环境；
4. 全局环境只能访问在全局环境中定义的变量和函数，而不能直接访问局部环境中的
任何数据；
5. 变量的执行环境有助于确定应何时释放内存。

```js
function f(){
    var a=1;
    aa=function(){//全局函数，前面如果加一个var那就是局部函数了
            a+=1;
        }
　　function bb(){
        alert(a);
    }
   return bb;
}
var f1=f();//得到返回值bb
f1();//1
aa();
f1();//2
```

此题中，aa函数是全局函数（因为前面没有var），可以直接在全局中被调用，并且它能访问f中的局部变量a，为什么？因为函数运行在定义它的环境中，而非调用它的环境中。对于aa来说，定义它的环境是f，调用它的环境是window。全局函数是说函数在任何作用域都可以被调用，也就是说它在全局任何一个角落都可以被访问，在任何角落都是有效的。但是当你在全局任何一个角落调用全局函数时，全局函数还是会回到定义它的作用域中，从那里开始沿着作用域链向上搜索各级执行环境，直到找到所需标识符为止。